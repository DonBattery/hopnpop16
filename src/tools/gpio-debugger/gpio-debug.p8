pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
g = _ENV

_env = { __index = _ENV }

function env(obj)
 return setmetatable(obj, _env)
end

function pixlen(s) return print(s, 0, 128) end

-- pretty print
function pprint(s, x, y, c1, c2, ind, out)
 x -= ind == "r" and print(s, 0, 128) or ind == "c" and print(s, 0, 128) / 2 or 0
 if out then
  for ox = -1, 1 do
   for oy = -1, 1 do
    if (ox | oy != 0) print(s, x + ox, y + oy, c2)
   end
  end
 else
  print(s, x, y + 1, c2)
 end
 print(s, x, y, c1)
end

-- draw a byte as a colored bitfield (x,y is the last bit of the byte)
function draw_bits(value, x, y)
 for i = 0, 7 do
  local bit = band(shr(value, 7 - i), 1)
  pset(x + i, y, bit == 1 and 11 or 5)
 end
end

function draw_gpio_debugger(y)
 y = y or 0
 --title
 rectfill(0, y, 62, y + 9, 0)
 rect(0, y, 62, y + 9, 7)
 pprint("gpio debugger", 2, y + 2, 7, 5)

 -- draw the first 8 gpio pin values
 for i = 0, 7 do
  local pin_x = i * 16
  local pin_y = y + 11

  rectfill(pin_x, pin_y, pin_x + 14, pin_y + 16, 0)
  rect(pin_x, pin_y, pin_x + 14, pin_y + 16, 7)
  local pin_value = peek(0x5f80 + i)

  -- draw pin number
  print(i + 1, pin_x + 2, pin_y + 2, 7)

  -- draw pin value
  print(pin_value, pin_x + 2, pin_y + 8, pin_value == 0 and 6 or 3)

  -- draw value as bitfield
  draw_bits(pin_value, pin_x + 2, pin_y + 15)
 end
end

function new_bunny(joy_id, pos_x, pos_y)
 return env({
  id = joy_id,
  x = pos_x,
  y = pos_y,
  s = 1,
  tick = 0,
  face_left = false,
  left_eye = false,
  right_eye = false,

  update = function(_ENV)
   local is_move = false
   if btn(0, id) then
    x = max(x - 1, 0)
    is_move = true
    face_left = true
   end
   if btn(1, id) then
    x = min(x + 1, 127)
    is_move = true
    face_left = false
   end
   if btn(2, id) then
    y = max(y - 1, 0)
    is_move = true
   end
   if btn(3, id) then
    y = min(y + 1, 127)
    is_move = true
   end
   if btn(4, id) then
    right_eye = true
   else
    right_eye = false
   end
   if btn(5, id) then
    left_eye = true
   else
    left_eye = false
   end
   if is_move then
    tick += 1
    if tick > 4 then
     tick = 0
     s += 1
     if s > 3 then
      s = 1
     end
    end
   else
    tick = 0
    s = 1
   end
  end,

  draw = function(_ENV)
   local s_i = s
   if id == 1 then
    s_i += 3
   end
   if left_eye then
    s_i += 16
   end
   if right_eye then
    s_i += 32
   end

   spr(s_i, x, y, 1, 1, face_left)
  end
 })
end

function _init()
 bunny_1 = new_bunny(0, 64, 64)
 bunny_2 = new_bunny(1, 32, 32)
end

function _update60()
 -- read button input for player 0 and 1
 local buttons = btn()

 -- the address of the first gpio pin
 local base = 0x5f80

 -- write the control inputs to the second and third gpio pins
 poke(base + 1, buttons & 0x3f)
 poke(base + 2, (buttons >> 8) & 0x3f)

 bunny_1:update()
 bunny_2:update()
end

function _draw()
 cls(1)

 draw_gpio_debugger()

 bunny_1:draw()
 bunny_2:draw()
end

__gfx__
0000000007f0f70007f0f7000000000009f0f90009f0f90000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7007f0f700009f0f90009f0f9009f0f9000000000000000000000000000000000000000000000000000000000000000000000000000
00700700077777000777770007f0f700099999000999990009f0f900000000000000000000000000000000000000000000000000000000000000000000000000
00077000770770707707707007777700990990909909909009999900000000000000000000000000000000000000000000000000000000000000000000000000
00077000777777707777777077077070999999909999999099099090000000000000000000000000000000000000000000000000000000000000000000000000
00700700007770000077700077777770009990000099900099999990000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700000777700009990000099900000999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070000007000000700000009090000009000000900000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7000000000009f0f90009f0f90000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7007f0f700009f0f90009f0f9009f0f9000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777000777770007f0f700099999000999990009f0f900000000000000000000000000000000000000000000000000000000000000000000000000
0000000077b7707077b770700777770099b9909099b9909009999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777707777777077b77070999999909999999099b99090000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700077777770009990000099900099999990000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700000777700009990000099900000999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070000007000000700000009090000009000000900000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7000000000009f0f90009f0f90000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7007f0f700009f0f90009f0f9009f0f9000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777000777770007f0f700099999000999990009f0f900000000000000000000000000000000000000000000000000000000000000000000000000
00000000770778707707787007777700990998909909989009999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777707777777077077870999999909999999099099890000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700077777770009990000099900099999990000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700000777700009990000099900000999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070000007000000700000009090000009000000900000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7000000000009f0f90009f0f90000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007f0f70007f0f7007f0f700009f0f90009f0f9009f0f9000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777000777770007f0f700099999000999990009f0f900000000000000000000000000000000000000000000000000000000000000000000000000
0000000077b7787077b778700777770099b9989099b9989009999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777707777777077b77870999999909999999099b99890000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700077777770009990000099900099999990000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077700000777700009990000099900000999900000000000000000000000000000000000000000000000000000000000000000000000000
00000000007070000007000000700000009090000009000000900000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77777777777777777777777777777777777777777777777777777777777777711111111111111111111111111111111111111111111111111111111111111111
70000000000000000000000000000000000000000000000000000000000000711111111111111111111111111111111111111111111111111111111111111111
70077077707770077000007700777077707070077007707770777000000000711111111111111111111111111111111111111111111111111111111111111111
70755075705750757000007570755075707070755075507550757000000000711111111111111111111111111111111111111111111111111111111111111111
70700077700700707000007070770077507070700070007700775000000000711111111111111111111111111111111111111111111111111111111111111111
70707075500700707000007070750075707070707070707500757000000000711111111111111111111111111111111111111111111111111111111111111111
70777070007770775000007770777077705770777077707770707000000000711111111111111111111111111111111111111111111111111111111111111111
70555050005550550000005550555055500550555055505550505000000000711111111111111111111111111111111111111111111111111111111111111111
70000000000000000000000000000000000000000000000000000000000000711111111111111111111111111111111111111111111111111111111111111111
77777777777777777777777777777777777777777777777777777777777777711111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
77777777777777717777777777777771777777777777777177777777777777717777777777777771777777777777777177777777777777717777777777777771
70000000000000717000000000000071700000000000007170000000000000717000000000000071700000000000007170000000000000717000000000000071
70770000000000717077700000000071707770000000007170707000000000717077700000000071707000000000007170777000000000717077700000000071
70070000000000717000700000000071700070000000007170707000000000717070000000000071707000000000007170007000000000717070700000000071
70070000000000717077700000000071700770000000007170777000000000717077700000000071707770000000007170007000000000717077700000000071
70070000000000717070000000000071700070000000007170007000000000717000700000000071707070000000007170007000000000717070700000000071
70777000000000717077700000000071707770000000007170007000000000717077700000000071707770000000007170007000000000717077700000000071
70000000000000717000000000000071700000000000007170000000000000717000000000000071700000000000007170000000000000717000000000000071
70666000000000717066600000000071703330333000007170666000000000717066600000000071706660000000007170666000000000717066600000000071
70606000000000717060600000000071700030003000007170606000000000717060600000000071706060000000007170606000000000717060600000000071
70606000000000717060600000000071700330333000007170606000000000717060600000000071706060000000007170606000000000717060600000000071
70606000000000717060600000000071700030300000007170606000000000717060600000000071706060000000007170606000000000717060600000000071
70666000000000717066600000000071703330333000007170666000000000717066600000000071706660000000007170666000000000717066600000000071
70000000000000717000000000000071700000000000007170000000000000717000000000000071700000000000007170000000000000717000000000000071
70000000000000717000000000000071700000000000007170000000000000717000000000000071700000000000007170000000000000717000000000000071
705555555500007170555555550000717055b5555500007170555555550000717055555555000071705555555500007170555555550000717055555555000071
77777777777777717777777777777771777777777777777177777777777777717777777777777771777777777777777177777777777777717777777777777771
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111119f1f9111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111119f1f9111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111199999111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
1111111111111111111111111111111199b991911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111999999911111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111119991111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111119991111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111119191111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111117f1f71111111111111111111111111111
111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111117f1f71111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111777771111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111117177177111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111117777777111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111177711111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111177711111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111171711111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111

